<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sumeru Infrastructures Chatbot</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        /* â”€â”€ Chat Toggle Button â”€â”€ */
        .chat-toggle {
            position: fixed;
            bottom: 20px; right: 20px;
            width: 65px; height: 65px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a4a2e 0%, #0d2d1a 100%);
            border: none; cursor: pointer;
            box-shadow: 0 8px 25px rgba(26,74,46,0.5);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease;
            z-index: 9999;
        }
        .chat-toggle:hover { transform: scale(1.1) rotate(5deg); box-shadow: 0 12px 35px rgba(26,74,46,0.6); }
        .chat-toggle svg { width: 32px; height: 32px; fill: white; }
        .chat-toggle.active { background: linear-gradient(135deg, #c47f2a 0%, #a06520 100%); transform: rotate(90deg); }
        .chat-icon, .close-icon { transition: all 0.3s ease; }
        .close-icon { display: none; }
        .chat-toggle.active .chat-icon { display: none; }
        .chat-toggle.active .close-icon { display: block; }
        .chat-toggle::before {
            content: '';
            position: absolute; width: 100%; height: 100%; border-radius: 50%;
            background: linear-gradient(135deg, #1a4a2e 0%, #0d2d1a 100%);
            opacity: 0.3; animation: pulse-ring 2s ease-out infinite;
        }
        @keyframes pulse-ring { 0%{transform:scale(1);opacity:0.3;} 50%{transform:scale(1.3);opacity:0;} 100%{transform:scale(1);opacity:0;} }

        /* â”€â”€ Chat Bubble â”€â”€ */
        .chat-bubble {
            position: fixed; bottom: 100px; right: 20px;
            background: linear-gradient(135deg, #1a4a2e 0%, #0d2d1a 100%);
            color: white; padding: 14px 18px;
            border-radius: 20px; border-bottom-right-radius: 4px;
            font-size: 14px; font-weight: 600;
            box-shadow: 0 8px 20px rgba(26,74,46,0.4);
            z-index: 9998; animation: bubbleFloat 3s ease-in-out infinite;
            display: flex; align-items: center; gap: 10px; max-width: 280px;
        }
        .chat-bubble.hidden { display: none; }
        @keyframes bubbleFloat { 0%,100%{transform:translateY(0) scale(1);} 50%{transform:translateY(-8px) scale(1.02);} }
        .wave-emoji { display: inline-block; animation: wave 1.5s ease-in-out infinite; font-size: 20px; }
        @keyframes wave { 0%,100%{transform:rotate(0deg);} 25%{transform:rotate(25deg);} 75%{transform:rotate(-15deg);} }

        /* â”€â”€ Notification Badge â”€â”€ */
        .notification-badge {
            position: absolute; top: -8px; right: -8px;
            background: linear-gradient(135deg, #c47f2a 0%, #a06520 100%);
            color: white; width: 26px; height: 26px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; border: 3px solid white;
            animation: badgePulse 2s ease-in-out infinite;
            box-shadow: 0 3px 10px rgba(196,127,42,0.4);
        }
        @keyframes badgePulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.15);} }

        /* â”€â”€ Chat Container â”€â”€ */
        .chat-container {
            position: fixed; bottom: 100px; right: 20px;
            width: 400px; height: 600px;
            background: white; border-radius: 20px;
            box-shadow: 0 15px 60px rgba(0,0,0,0.3);
            display: none; flex-direction: column; overflow: hidden;
            z-index: 9999; animation: slideUpScale 0.4s cubic-bezier(0.34,1.56,0.64,1);
        }
        .chat-container.active { display: flex; }
        @keyframes slideUpScale { from{opacity:0;transform:translateY(30px) scale(0.9);} to{opacity:1;transform:translateY(0) scale(1);} }

        /* â”€â”€ Chat Header â”€â”€ */
        .chat-header {
            background: linear-gradient(135deg, #1a4a2e 0%, #0d2d1a 100%);
            color: white; padding: 13px 14px;
            display: flex; align-items: center; gap: 10px;
            box-shadow: 0 4px 15px rgba(26,74,46,0.3);
            flex-shrink: 0; position: relative; overflow: hidden;
        }
        .chat-header::before {
            content: ''; position: absolute; top: -50%; right: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);
            animation: headerShine 3s ease-in-out infinite;
        }
        @keyframes headerShine { 0%,100%{transform:translate(-50%,-50%);} 50%{transform:translate(0%,0%);} }
        .chat-header-avatar {
            width: 44px; height: 44px; border-radius: 50%; background: white;
            display: flex; align-items: center; justify-content: center; font-size: 22px;
            flex-shrink: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border: 3px solid rgba(196,127,42,0.5); position: relative; z-index: 1;
        }
        .chat-header-info { flex: 1; position: relative; z-index: 1; min-width: 0; }
        .chat-header-info h3 { font-size: 14px; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chat-header-info p  { font-size: 11px; opacity: 0.9; display: flex; align-items: center; gap: 5px; }
        .status-dot {
            width: 7px; height: 7px; background: #4ade80; border-radius: 50%;
            display: inline-block; animation: statusBlink 2s ease-in-out infinite; box-shadow: 0 0 8px #4ade80;
        }
        @keyframes statusBlink { 0%,100%{opacity:1;} 50%{opacity:0.5;} }
        .ai-badge {
            background: rgba(196,127,42,0.3); padding: 3px 9px; border-radius: 14px;
            font-size: 9px; font-weight: bold; margin-top: 3px; display: inline-block;
            border: 1px solid rgba(196,127,42,0.5);
        }

        /* â”€â”€ Registration Overlay â”€â”€ */
        .registration-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 10; display: flex; flex-direction: column; overflow-y: auto;
        }
        .registration-overlay.hidden { display: none; }
        .registration-header {
            background: linear-gradient(135deg, #1a4a2e 0%, #0d2d1a 100%);
            color: white; padding: 22px 20px; text-align: center; flex-shrink: 0; position: relative; overflow: hidden;
        }
        .registration-header::before { content:'ğŸ¢'; position:absolute; font-size:80px; opacity:0.1; top:50%; left:50%; transform:translate(-50%,-50%) rotate(-15deg); }
        .registration-header h2 { font-size: 19px; margin-bottom: 6px; position: relative; z-index: 1; }
        .registration-header p  { font-size: 13px; opacity: 0.9; position: relative; z-index: 1; }
        .registration-form { flex: 1; padding: 22px; overflow-y: auto; background: linear-gradient(to bottom,#fafafa,#fff); }
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; margin-bottom: 7px; font-size: 14px; font-weight: 600; color: #333; }
        .form-group label .required { color: #c47f2a; }
        .form-group input {
            width: 100%; padding: 12px 16px; border: 2px solid #e5e5e5;
            border-radius: 12px; font-size: 14px; transition: all 0.3s ease; outline: none; background: white;
        }
        .form-group input:focus { border-color: #1a4a2e; box-shadow: 0 0 0 4px rgba(26,74,46,0.1); transform: translateY(-1px); }
        .form-group input.error { border-color: #c47f2a; animation: shake 0.5s ease; }
        @keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-10px);} 75%{transform:translateX(10px);} }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
        .error-message { color: #c47f2a; font-size: 12px; margin-top: 6px; display: none; }
        .error-message.show { display: block; animation: fadeIn 0.3s ease; }
        .submit-btn {
            width: 100%; padding: 13px; background: linear-gradient(135deg,#1a4a2e,#0d2d1a);
            color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease; margin-top: 6px; box-shadow: 0 4px 15px rgba(26,74,46,0.4);
        }
        .submit-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(26,74,46,0.5); }
        .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .form-note { text-align: center; font-size: 12px; color: #666; margin-top: 14px; padding: 12px; background: white; border-radius: 10px; border: 1px solid #e5e5e5; }
        .loading-spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid white; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 8px; }
        @keyframes spin { to{transform:rotate(360deg);} }

        /* â”€â”€ Chat Messages â”€â”€ */
        .chat-messages { flex: 1; padding: 16px; overflow-y: auto; background: linear-gradient(to bottom,#f9f9f7,#fff); -webkit-overflow-scrolling: touch; }
        .chat-messages::-webkit-scrollbar { width: 6px; }
        .chat-messages::-webkit-scrollbar-thumb { background: #d4d4d4; border-radius: 10px; }
        .message { margin-bottom: 14px; display: flex; animation: messageSlide 0.4s ease; }
        @keyframes messageSlide { from{opacity:0;transform:translateY(15px);} to{opacity:1;transform:translateY(0);} }
        .message.bot  { justify-content: flex-start; }
        .message.user { justify-content: flex-end; }
        .message-content { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.6; word-wrap: break-word; }
        .message.bot .message-content  { background: white; color: #333; border-bottom-left-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #f0f0f0; }
        .message.user .message-content { background: linear-gradient(135deg,#1a4a2e,#0d2d1a); color: white; border-bottom-right-radius: 4px; box-shadow: 0 2px 8px rgba(26,74,46,0.4); }

        /* â”€â”€ Quick Replies â”€â”€ */
        .quick-replies { padding: 10px 14px; background: white; border-top: 1px solid #e5e5e5; display: flex; gap: 8px; flex-wrap: wrap; overflow-x: auto; flex-shrink: 0; max-height: 95px; }
        .quick-replies::-webkit-scrollbar { height: 0; }
        .quick-reply-btn { padding: 7px 13px; background: linear-gradient(135deg,#f9f9f7,#fff); border: 2px solid #e5e5e5; border-radius: 20px; font-size: 12px; cursor: pointer; transition: all 0.3s ease; white-space: nowrap; flex-shrink: 0; font-weight: 500; }
        .quick-reply-btn:hover { background: linear-gradient(135deg,#1a4a2e,#0d2d1a); color: white; border-color: transparent; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(26,74,46,0.4); }
        .back-to-menu-btn { padding: 7px 13px; background: linear-gradient(135deg,#c47f2a,#a06520); border: none; border-radius: 20px; color: white; font-size: 12px; cursor: pointer; transition: all 0.3s ease; white-space: nowrap; flex-shrink: 0; font-weight: 600; display: none; }
        .back-to-menu-btn.show { display: inline-block; }
        .back-to-menu-btn:hover { background: linear-gradient(135deg,#a06520,#7a4e18); transform: translateY(-2px); }

        /* â”€â”€ Chat Input â”€â”€ */
        .chat-input { padding: 12px 14px; background: white; border-top: 1px solid #e5e5e5; display: flex; gap: 10px; align-items: center; flex-shrink: 0; }
        .chat-input input { flex: 1; padding: 11px 16px; border: 2px solid #e5e5e5; border-radius: 24px; font-size: 14px; outline: none; transition: all 0.3s ease; background: #fafafa; }
        .chat-input input:focus { border-color: #1a4a2e; background: white; box-shadow: 0 0 0 3px rgba(26,74,46,0.1); }
        .chat-input input:disabled { background: #f5f5f5; cursor: not-allowed; }
        .chat-input button { width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg,#1a4a2e,#0d2d1a); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; flex-shrink: 0; box-shadow: 0 3px 10px rgba(26,74,46,0.4); }
        .chat-input button:hover:not(:disabled) { transform: scale(1.1) rotate(5deg); }
        .chat-input button:disabled { opacity: 0.5; cursor: not-allowed; }
        .chat-input button svg { width: 20px; height: 20px; fill: white; }

        /* â”€â”€ Typing Indicator â”€â”€ */
        .typing-indicator { display: none; padding: 12px 16px; background: white; border-radius: 18px; border-bottom-left-radius: 4px; max-width: 75px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #f0f0f0; }
        .typing-indicator span { height: 9px; width: 9px; background: #1a4a2e; border-radius: 50%; display: inline-block; margin-right: 5px; animation: typing 1.4s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; margin-right: 0; }
        @keyframes typing { 0%,60%,100%{transform:translateY(0);opacity:0.7;} 30%{transform:translateY(-10px);opacity:1;} }

        /* â”€â”€ Mobile â”€â”€ */
        @media (max-width: 768px) {
            .chat-container { bottom:0;right:0;left:0;top:0;width:100%;height:100%;border-radius:0;max-height:100vh; }
            .chat-bubble { bottom:95px;right:15px;max-width:220px;font-size:13px; }
            .chat-toggle { bottom:15px;right:15px;width:60px;height:60px; }
        }
    </style>
</head>
<body>

<!-- Chat Bubble -->
<div class="chat-bubble" id="chatBubble">
    <span class="wave-emoji">ğŸ‘‹</span>
    <span>Looking for your dream property?</span>
</div>

<!-- Chat Toggle Button -->
<button class="chat-toggle" id="chatToggle">
    <span class="notification-badge">1</span>
    <svg viewBox="0 0 24 24" class="chat-icon"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
    <svg viewBox="0 0 24 24" class="close-icon"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
</button>

<!-- Chat Container -->
<div class="chat-container" id="chatContainer">

    <!-- Registration Overlay -->
    <div class="registration-overlay" id="registrationOverlay">
        <div class="registration-header">
            <h2>ğŸ¢ Welcome to Sumeru Infrastructures!</h2>
            <p>Please share your details to start chatting</p>
        </div>
        <div class="registration-form">
            <form id="userDetailsForm">
                <div class="form-group">
                    <label for="userName">Your Name <span class="required">*</span></label>
                    <input type="text" id="userName" placeholder="Enter your full name" required>
                    <div class="error-message" id="nameError">Please enter your name</div>
                </div>
                <div class="form-group">
                    <label for="userEmail">Email Address <span class="required">*</span></label>
                    <input type="email" id="userEmail" placeholder="example@email.com" required>
                    <div class="error-message" id="emailError">Please enter a valid email</div>
                </div>
                <div class="form-group">
                    <label for="userPhone">Phone Number <span class="required">*</span></label>
                    <input type="tel" id="userPhone" placeholder="10-digit mobile number" required maxlength="10">
                    <div class="error-message" id="phoneError">Please enter a valid 10-digit number</div>
                </div>
                <button type="submit" class="submit-btn" id="submitBtn">Start Chatting ğŸ¡</button>
                <div class="form-note">ğŸ”’ Your information is secure and will only be used to provide better property assistance.</div>
            </form>
        </div>
    </div>

    <!-- Chat Header -->
    <div class="chat-header">
        <div class="chat-header-avatar">ğŸ¢</div>
        <div class="chat-header-info">
            <h3>Sumeru Infrastructures</h3>
            <p><span class="status-dot"></span><span>Online â€¢ Ready to help</span></p>
            <span class="ai-badge">ğŸ¤– AI-POWERED</span>
        </div>
    </div>

    <!-- Chat Messages -->
    <div class="chat-messages" id="chatMessages">
        <div class="message bot">
            <div class="typing-indicator" id="typingIndicator">
                <span></span><span></span><span></span>
            </div>
        </div>
    </div>

    <!-- Quick Replies -->
    <div class="quick-replies" id="quickReplies">
        <button class="back-to-menu-btn" id="backToMenuBtn">â¬…ï¸ Back to Menu</button>
        <button class="quick-reply-btn" data-reply="Tell me about Eastern Arc">ğŸ¡ Eastern Arc</button>
        <button class="quick-reply-btn" data-reply="Tell me about Paras Tower">ğŸ¢ Paras Tower</button>
        <button class="quick-reply-btn" data-reply="Tell me about Sumeru Vihar">ğŸŒ¿ Sumeru Vihar</button>
        <button class="quick-reply-btn" data-reply="apartment types and configurations">ğŸ  Apartments</button>
        <button class="quick-reply-btn" data-reply="amenities in the project">âœ¨ Amenities</button>
        <button class="quick-reply-btn" data-reply="property investment">ğŸ’° Investment</button>
        <button class="quick-reply-btn" data-reply="How can I contact you?">ğŸ“ Contact</button>
    </div>

    <!-- Chat Input -->
    <div class="chat-input">
        <input type="text" id="userInput" placeholder="Ask about our properties..." disabled>
        <button id="sendBtn" disabled>
            <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
    </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const API_URL      = "https://sumeru-infrastructures.vercel.app/api/chat";
const REGISTER_URL = "https://sumeru-infrastructures.vercel.app/api/register";
const CALLBACK_URL = "https://sumeru-infrastructures.vercel.app/api/callback-request";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM ELEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const chatToggle          = document.getElementById('chatToggle');
const chatContainer       = document.getElementById('chatContainer');
const chatBubble          = document.getElementById('chatBubble');
const chatMessages        = document.getElementById('chatMessages');
const userInput           = document.getElementById('userInput');
const sendBtn             = document.getElementById('sendBtn');
const quickReplies        = document.getElementById('quickReplies');
const typingIndicator     = document.getElementById('typingIndicator');
const registrationOverlay = document.getElementById('registrationOverlay');
const userDetailsForm     = document.getElementById('userDetailsForm');
const submitBtn           = document.getElementById('submitBtn');
const backToMenuBtn       = document.getElementById('backToMenuBtn');
const userNameEl          = document.getElementById('userName');
const userEmailEl         = document.getElementById('userEmail');
const userPhoneEl         = document.getElementById('userPhone');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let isProcessing       = false;
let isRegistered       = false;
let userData           = {};
let waitingForCallback = false;
let pendingQuery       = '';

if (localStorage.getItem('suUserRegistered')) {
    isRegistered = true;
    userData = JSON.parse(localStorage.getItem('suUserData'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VALIDATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function validateEmail(email)         { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }
function validatePhone(phone)         { return /^[6-9]\d{9}$/.test(phone); }
function validateCallbackPhone(phone) {
    const c = phone.replace(/\D/g,'');
    return c.length === 10 && /^[6-9]\d{9}$/.test(c);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALLBACK HANDLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function handleCallbackRequest(number) {
    try {
        const res  = await fetch(CALLBACK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: userData.name, email: userData.email, phone: userData.phone, query: pendingQuery, callback_number: number })
        });
        const data = await res.json();
        addMessage(data.success
            ? `Thank you! âœ… Callback request received.\n\nğŸ“ We'll call you at: ${number}\n\nOur property expert will reach out shortly.\n\nAnything else I can help you with?`
            : "Sorry, something went wrong. Please contact:\nğŸŒ https://www.sumeruinfrastructures.com/contact",
            'bot');
        waitingForCallback = false;
        pendingQuery = '';
        showDefaultQuickReplies();
    } catch {
        addMessage("Connection error. Please visit:\nğŸŒ https://www.sumeruinfrastructures.com/contact", 'bot');
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MENU HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
backToMenuBtn.addEventListener('click', () => resetToMainMenu());

function resetToMainMenu() {
    waitingForCallback = false;
    pendingQuery = '';
    showDefaultQuickReplies();
    addMessage("Back to main menu! ğŸ¢ How can I help you find your perfect property?", 'bot');
}

function showDefaultQuickReplies() {
    quickReplies.innerHTML = `
        <button class="back-to-menu-btn show" id="backToMenuBtn">â¬…ï¸ Back to Menu</button>
        <button class="quick-reply-btn" data-reply="Tell me about Eastern Arc">ğŸ¡ Eastern Arc</button>
        <button class="quick-reply-btn" data-reply="Tell me about Paras Tower">ğŸ¢ Paras Tower</button>
        <button class="quick-reply-btn" data-reply="Tell me about Sumeru Vihar">ğŸŒ¿ Sumeru Vihar</button>
        <button class="quick-reply-btn" data-reply="apartment types and configurations">ğŸ  Apartments</button>
        <button class="quick-reply-btn" data-reply="amenities in the project">âœ¨ Amenities</button>
        <button class="quick-reply-btn" data-reply="property investment">ğŸ’° Investment</button>
        <button class="quick-reply-btn" data-reply="How can I contact you?">ğŸ“ Contact</button>
    `;
    document.getElementById('backToMenuBtn').addEventListener('click', resetToMainMenu);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAT TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
chatToggle.addEventListener('click', () => {
    chatContainer.classList.toggle('active');
    chatToggle.classList.toggle('active');

    if (chatContainer.classList.contains('active')) {
        chatBubble.classList.add('hidden');
        hideBadge();
        if (isRegistered) {
            registrationOverlay.classList.add('hidden');
            userInput.focus();
            if (!localStorage.getItem('suWelcomeShown')) {
                setTimeout(() => {
                    addMessage(`Hello ${userData.name}! ğŸ‘‹ Welcome to Sumeru Infrastructures!\n\nI'm your personal property assistant. Ask me about Eastern Arc, Paras Tower, Sumeru Vihar â€” or anything about apartments, amenities, pricing, and investment! ğŸ¡`, 'bot');
                    localStorage.setItem('suWelcomeShown', 'true');
                }, 300);
            }
        } else {
            registrationOverlay.classList.remove('hidden');
            userNameEl.focus();
        }
    } else {
        chatBubble.classList.remove('hidden');
    }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REGISTRATION FORM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
userDetailsForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
    document.querySelectorAll('input').forEach(el => el.classList.remove('error'));

    const name  = userNameEl.value.trim();
    const email = userEmailEl.value.trim();
    const phone = userPhoneEl.value.trim();
    let hasError = false;

    if (!name) {
        userNameEl.classList.add('error');
        const el = document.getElementById('nameError');
        el.textContent = 'Please enter your name'; el.classList.add('show');
        hasError = true;
    }
    if (!email || !validateEmail(email)) {
        userEmailEl.classList.add('error');
        const el = document.getElementById('emailError');
        el.textContent = !email ? 'Please enter your email' : 'Please enter a valid email'; el.classList.add('show');
        hasError = true;
    }
    if (!phone || !validatePhone(phone)) {
        userPhoneEl.classList.add('error');
        const el = document.getElementById('phoneError');
        el.textContent = !phone ? 'Please enter your phone number' : 'Please enter a valid 10-digit number'; el.classList.add('show');
        hasError = true;
    }
    if (hasError) return;

    submitBtn.disabled = true;
    submitBtn.innerHTML = `<span class="loading-spinner"></span>Processing...`;

    try {
        const res  = await fetch(REGISTER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, phone })
        });
        const data = await res.json();

        if (data.success) {
            userData = { name, email, phone };
            localStorage.setItem('suUserRegistered', 'true');
            localStorage.setItem('suUserData', JSON.stringify(userData));
            isRegistered = true;
            registrationOverlay.classList.add('hidden');
            userInput.disabled = false;
            sendBtn.disabled = false;
            userInput.focus();
            setTimeout(() => {
                addMessage(`Hello ${name}! ğŸ‘‹ Welcome to Sumeru Infrastructures!\n\nI'm your personal property assistant. Ask me about Eastern Arc, Paras Tower, Sumeru Vihar â€” or anything about apartments, amenities, pricing, and investment! ğŸ¡`, 'bot');
                localStorage.setItem('suWelcomeShown', 'true');
            }, 300);
        } else {
            alert(data.error || 'Registration failed. Please try again.');
        }
    } catch {
        alert('Connection error. Please check your internet and try again.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Start Chatting ğŸ¡';
    }
});

userPhoneEl.addEventListener('input', (e) => {
    e.target.value = e.target.value.replace(/\D/g,'').slice(0,10);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEND MESSAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function sendMessage() {
    const message = userInput.value.trim();
    if (!message || isProcessing) return;

    // Waiting for callback phone number
    if (waitingForCallback) {
        if (validateCallbackPhone(message)) {
            addMessage(message, 'user');
            userInput.value = '';
            isProcessing = true;
            typingIndicator.style.display = 'block';
            userInput.disabled = true; sendBtn.disabled = true;
            scrollToBottom();
            await handleCallbackRequest(message);
            isProcessing = false;
            typingIndicator.style.display = 'none';
            userInput.disabled = false; sendBtn.disabled = false;
            userInput.focus();
        } else {
            addMessage(message, 'user');
            addMessage("âŒ Please enter a valid 10-digit number starting with 6, 7, 8, or 9.\n\nExample: 9876543210", 'bot');
            userInput.value = '';
        }
        return;
    }

    addMessage(message, 'user');
    userInput.value = '';
    isProcessing = true;
    typingIndicator.style.display = 'block';
    userInput.disabled = true; sendBtn.disabled = true;
    scrollToBottom();

    try {
        const res = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
        });
        if (!res.ok) throw new Error('http');
        const data = await res.json();
        typingIndicator.style.display = 'none';

        if (data.success && data.reply) {
            addMessage(data.reply, 'bot');
            if (data.requiresCallback) {
                waitingForCallback = true;
                pendingQuery = data.userQuery || message;
                quickReplies.innerHTML = `<button class="back-to-menu-btn show" id="backToMenuBtn">â¬…ï¸ Cancel</button>`;
                document.getElementById('backToMenuBtn').addEventListener('click', () => {
                    waitingForCallback = false; pendingQuery = '';
                    resetToMainMenu();
                });
            }
        } else {
            throw new Error('invalid');
        }
    } catch (err) {
        typingIndicator.style.display = 'none';
        addMessage(String(err).includes('fetch') ? "Unable to connect. Please check your internet and try again." : "Sorry, I encountered an error. Please try again.", 'bot');
    } finally {
        isProcessing = false;
        userInput.disabled = false; sendBtn.disabled = false;
        userInput.focus();
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADD MESSAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addMessage(text, sender) {
    const div = document.createElement('div');
    div.className = `message ${sender}`;
    const content = document.createElement('div');
    content.className = 'message-content';
    content.innerHTML = text
        .replace(/\n/g,'<br>')
        .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
        .replace(/\*(.*?)\*/g,'<em>$1</em>')
        .replace(/(https?:\/\/[^\s<]+)/g,'<a href="$1" target="_blank" rel="noopener noreferrer" style="color:#1a7a52;text-decoration:underline;word-break:break-all;">$1</a>');
    div.appendChild(content);
    chatMessages.insertBefore(div, typingIndicator.parentElement);
    scrollToBottom();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function scrollToBottom() { setTimeout(() => { chatMessages.scrollTop = chatMessages.scrollHeight; }, 100); }
function hideBadge() { setTimeout(() => { const b = document.querySelector('.notification-badge'); if(b) b.style.display='none'; }, 300); }

// Event listeners
sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', (e) => { if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();} });
quickReplies.addEventListener('click', (e) => {
    if (e.target.classList.contains('quick-reply-btn')) {
        const r = e.target.getAttribute('data-reply');
        if (r) { userInput.value = r; sendMessage(); }
    }
});
document.addEventListener('keydown', (e) => { if(e.key==='Escape'&&chatContainer.classList.contains('active')) chatToggle.click(); });

console.log('ğŸ¢ Sumeru Infrastructures Chatbot âœ…');
</script>
</body>
</html>
